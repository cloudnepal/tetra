(()=>{var s={init(){Alpine.magic("static",()=>s.$static)},$static(){return e=>window.__tetra_staticRoot+e},alpineComponentMixins(){return{init(){this.$dispatch("tetra:child-component-init",{component:this}),this.__initServerWatchers(),this.__initInner&&this.__initInner()},destroy(){this.$dispatch("tetra:child-component-destroy",{component:this}),this.__destroyInner&&this.__destroyInner()},_updateHtml(e){Alpine.morph(this.$root,e,{updating(t,r,n,i){if(r.hasAttribute&&r.hasAttribute("x-data-maintain")&&t.hasAttribute&&t.hasAttribute("x-data"))r.setAttribute("x-data",t.getAttribute("x-data")),r.removeAttribute("x-data-maintain");else if(r.hasAttribute&&r.hasAttribute("x-data-update")&&t.hasAttribute&&t.hasAttribute("x-data")){let a=s.jsonDecode(r.getAttribute("x-data-update")),c=s.jsonDecode(r.getAttribute("x-data-update-old")),d=window.Alpine.$data(t);for(let o in a)c.hasOwnProperty(o)&&c[o]!==d[o]||(d[o]=a[o]);r.setAttribute("x-data",t.getAttribute("x-data")),r.removeAttribute("x-data-update")}},lookahead:!0})},_updateData(e){for(let t in e)this[t]=e[t]},_removeComponent(){this.$root.remove()},_replaceComponent(e){this.$root.insertAdjacentHTML("afterend",e),this.$root.remove()},_redirect(e){document.location=e},_dispatch(e,t){this.$dispatch(e,{_component:this,...t})},_pushUrl(e,t=!1){t?window.history.replaceState(null,"",e):window.history.pushState(null,"",e)},__initServerWatchers(){this.__serverMethods.forEach(e=>{e.watch&&e.watch.forEach(t=>{this.$watch(t,async(r,n)=>{await this[e.name](r,n,t)})})})},__childComponents:{},__rootBind:{["@tetra:child-component-init"](e){e.stopPropagation();let t=e.detail.component;t.key!==this.key&&(t.key&&(this.__childComponents[t.key]=t),t._parent=this)},["@tetra:child-component-destroy"](e){e.stopPropagation();let t=e.detail.component;t.key!==this.key&&(delete this.__childComponents[t.key],e.detail.component._parent=null)}}}},makeServerMethods(e){let t={};return e.forEach(r=>{var n=async function(...i){return await s.callServerMethod(this,r.name,r.endpoint,i)};r.debounce?n=s.debounce(n,r.debounce,r.debounce_immediate):r.throttle&&(n=s.throttle(n,r.throttle,{leading:r.throttle_leading,trailing:r.throttle_trailing})),t[r.name]=n}),t},makeAlpineComponent(e,t,r,n){Alpine.data(e,i=>{let{init:a,destroy:c,...d}=t,o=s.jsonDecode(i);return{componentName:e,__initInner:a,__destroyInner:c,__serverMethods:r,__serverProperties:n,...o||{},...d,...s.makeServerMethods(r),...s.alpineComponentMixins()}})},getStateWithChildren(e){let t={};e.__serverProperties.forEach(n=>{t[n]=e[n]});let r={state:e.__state,data:t,children:[]};for(let n in e.__childComponents){let i=e.__childComponents[n];r.children.push(s.getStateWithChildren(i))}return r},loadScript(e){return new Promise((t,r)=>{let n=document.createElement("script");n.src=e,n.onload=t,n.onerror=r,document.head.appendChild(n)})},loadStyles(e){return new Promise((t,r)=>{let n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=r,document.head.appendChild(n)})},async callServerMethod(e,t,r,n){let i=s.getStateWithChildren(e);i.args=n;let a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":window.__tetra_csrfToken},mode:"same-origin",body:s.jsonEncode(i)});if(a.status===200){let c=s.jsonDecode(await a.text());if(c.success){let d=[];return c.js.forEach(o=>{document.querySelector(`script[src="${CSS.escape(o)}"]`)||d.push(s.loadScript(o))}),c.styles.forEach(o=>{document.querySelector(`link[href="${CSS.escape(o)}"]`)||d.push(s.loadStyles(o))}),await Promise.all(d),c.callbacks&&c.callbacks.forEach(o=>{let l=e;o.callback.forEach((h,p)=>{p===o.callback.length-1?l[h](...o.args):(l=l[h],console.log(h,l))})}),c.result}else throw new Error("Error processing public method")}else throw new Error(`Server responded with an error ${a.status} (${a.statusText})`)},jsonReplacer(e,t){return t instanceof Date?{__type:"datetime",value:t.toISOString()}:t instanceof Set?{__type:"set",value:Array.from(t)}:t},jsonReviver(e,t){if(t&&typeof t=="object"&&t.__type){if(t.__type==="datetime")return new Date(t);if(t.__type==="set")return new Set(t)}return t},jsonEncode(e){return JSON.stringify(e,s.jsonReplacer)},jsonDecode(e){var t=JSON.parse(e,s.jsonReviver);return t},debounce(e,t,r){var n;return function(){var i=this,a=arguments,c=function(){n=null,r||e.apply(i,a)},d=r&&!n;clearTimeout(n),n=setTimeout(c,t),d&&e.apply(i,a)}},throttle(e,t,r){var n,i,a,c,d=0;r||(r={});var o=function(){d=r.leading===!1?0:now(),n=null,c=e.apply(i,a),n||(i=a=null)},l=function(){var h=new Date().getTime();!d&&r.leading===!1&&(d=h);var p=t-(h-d);return i=this,a=arguments,p<=0||p>t?(n&&(clearTimeout(n),n=null),d=h,c=e.apply(i,a),n||(i=a=null)):!n&&r.trailing!==!1&&(n=setTimeout(o,p)),c};return l.cancel=function(){clearTimeout(n),d=0,n=i=a=null},l}},u=s;window.Tetra=u;window.document.addEventListener("alpine:init",()=>{u.init()});})();
//# sourceMappingURL=tetra.min.js.map
